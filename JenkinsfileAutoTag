@Library('vl-jenkins')_

import no.nav.jenkins.*

node('DOCKER3') {
    Date date= new Date()
    def tagName="5.0_" + date.format("YYYYMMDDHHmmss")
    
    maven = new maven()
    stage('Checkout Tags') { // checkout only tags.
        checkout scm
        echo "Tag to be deployed $tagName"
        maven.setVersion(maven.artifactId(), tagName)      
   }
   
   stage('Build') {
       configFileProvider(
           [configFile(fileId: 'navMavenSettingsUtenProxy', variable: 'MAVEN_SETTINGS')]) {
		environment = new environment()
                if(maven.javaVersion() != null) {
                    environment.overrideJDK(maven.javaVersion())
                }
                // install byttes ut med deploy når alt er på plass 
                sh "mvn -U -B -s $MAVEN_SETTINGS -Dfile.encoding=UTF-8 -Djava.security.egd=file:///dev/urandom -DinstallAtEnd=true -DdeployAtEnd=true clean install"
           }   
                
    }
}
